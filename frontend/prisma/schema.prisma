// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// EVE tables
model flow {
  id            BigInt @id
  ts_start      BigInt?
  ts_end        BigInt?
  src_ip        String
  src_port      Int?
  dest_ip       String
  dest_port     Int?
  pcap_filename String?
  proto         String
  app_proto     String?
  metadata      Json? @db.Json
  extra_data    Json? @db.Json

  @@index(fields: [ts_start], name: "flow_ts_start_idx")
  @@index(fields: [app_proto], name: "flow_app_proto_idx")
  @@index(fields: [src_ip, src_port], name: "flow_src_ipport_idx")
  @@index(fields: [dest_ip, dest_port], name: "flow_dest_ipport_idx")
}

model fileinfo {
  id          Int @id @default(autoincrement())
  flow_id     BigInt
  timestamp   BigInt
  extra_data  Json? @db.Json

  @@unique([flow_id, timestamp])

  @@index(fields: [flow_id], name: "fileinfo_flow_id_idx")
}

model app_event {
  id          Int @id @default(autoincrement())
  flow_id     BigInt
  timestamp   BigInt
  app_proto   String
  extra_data  Json? @db.Json

  @@unique([flow_id, app_proto, timestamp])

  @@index(fields: [flow_id], name: "app_event_flow_id_idx")
}

model anomaly {
  id          Int @id @default(autoincrement())
  flow_id     BigInt
  timestamp   BigInt
  extra_data  Json? @db.Json

  @@unique([flow_id, timestamp])

  @@index(fields: [flow_id], name: "anomaly_flow_id_idx")
}

model alert {
  id          Int @id @default(autoincrement())
  flow_id     BigInt
  tag         String?
  color       String?
  timestamp   BigInt
  extra_data  Json? @db.Json

  @@unique([flow_id, tag])

  @@index(fields: [tag], name: "alert_tag_idx")
  @@index(fields: [flow_id], name: "alert_flow_id_idx")
}


// Payload tables
model raw {
  id                Int @id @default(autoincrement())
  flow_id           BigInt
  count             Int?
  server_to_client  Int?
  blob              Bytes?

  @@unique([flow_id, count])

  @@index(fields: [flow_id], name: "raw_flow_id_idx")
}